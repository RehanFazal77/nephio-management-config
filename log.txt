 1029                    type: object
 1030                    additionalProperties:
 1031                      type: object
 1032                      properties:
 1033                        id:
 1034                          type: string
 1035                        podref:
 1036                          type: string
 1037  ---
 1038  apiVersion: apiextensions.k8s.io/v1
 1039  kind: CustomResourceDefinition
 1040  metadata:
 1041    name: overlappingrangeipreservations.whereabouts.cni.cncf.io
 1042  spec:
 1043    group: whereabouts.cni.cncf.io
 1044    names:
 1045      kind: OverlappingRangeIPReservation
 1046      listKind: OverlappingRangeIPReservationList
 1047      plural: overlappingrangeipreservations
 1048      singular: overlappingrangeipreservation
 1049    scope: Namespaced
 1050    versions:
 1051      - name: v1alpha1
 1052        served: true
 1053        storage: true
 1054        schema:
 1055          openAPIV3Schema:
 1056            type: object
 1057            properties:
 1058              spec:
 1059                type: object
 1060                properties:
 1061                  podref:
 1062                    type: string
 1063  ---
 1064  apiVersion: v1
 1065  kind: ServiceAccount
 1066  metadata:
 1067    name: whereabouts
 1068    namespace: kube-system
 1069  ---
 1070  apiVersion: rbac.authorization.k8s.io/v1
 1071  kind: ClusterRole
 1072  metadata:
 1073    name: whereabouts
 1074  rules:
 1075    - apiGroups: ["whereabouts.cni.cncf.io"]
 1076      resources: ["ippools", "overlappingrangeipreservations"]
 1077      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
 1078    - apiGroups: [""]
 1079      resources: ["pods"]
 1080      verbs: ["list", "watch"]
 1081    - apiGroups: [""]
 1082      resources: ["events"]
 1083      verbs: ["create", "patch"]
 1084    - apiGroups: ["coordination.k8s.io"]
 1085      resources: ["leases"]
 1086      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
 1087  ---
 1088  apiVersion: rbac.authorization.k8s.io/v1
 1089  kind: ClusterRoleBinding
 1090  metadata:
 1091    name: whereabouts
 1092  roleRef:
 1093    apiGroup: rbac.authorization.k8s.io
 1094    kind: ClusterRole
 1095    name: whereabouts
 1096  subjects:
 1097    - kind: ServiceAccount
 1098      name: whereabouts
 1099      namespace: kube-system
 1100  ---
 1101  apiVersion: apps/v1
 1102  kind: DaemonSet
 1103  metadata:
 1104    name: whereabouts
 1105    namespace: kube-system
 1106  spec:
 1107    selector:
 1108      matchLabels:
 1109        name: whereabouts
 1110    template:
 1111      metadata:
 1112        labels:
 1113          name: whereabouts
 1114      spec:
 1115        hostNetwork: true
 1116        tolerations:
 1117          - operator: Exists
 1118        serviceAccountName: whereabouts
 1119        containers:
 1120          - name: whereabouts
 1121            image: ghcr.io/k8snetworkplumbingwg/whereabouts:v0.7.0
 1122            command: ["/ip-control-loop"]
 1123            args:
 1124              - "-log-level"
 1125              - "debug"
 1126            volumeMounts:
 1127              - name: cnibin
 1128                mountPath: /host/opt/cni/bin
 1129        initContainers:
 1130          - name: install-cni
 1131            image: ghcr.io/k8snetworkplumbingwg/whereabouts:v0.7.0
 1132            command: ["cp", "/whereabouts", "/host/opt/cni/bin/whereabouts"]
 1133            volumeMounts:
 1134              - name: cnibin
 1135                mountPath: /host/opt/cni/bin
 1136        volumes:
 1137          - name: cnibin
 1138            hostPath:
 1139              path: /opt/cni/bin
 1140  WHEREEOF
 1141  git add .
 1142  git commit -m "Fix incomplete multus and whereabouts YAML files"
 1143  git push origin main
 1144  kubectl config use-context nephio-mgmt
 1145  cat << 'EOF' | kubectl apply -f -
 1146  apiVersion: config.porch.kpt.dev/v1alpha2
 1147  kind: PackageVariant
 1148  metadata:
 1149    name: baseline-my-ran
 1150    namespace: default
 1151  spec:
 1152    upstream:
 1153      repo: nephio-blueprints
 1154      package: cluster-baseline
 1155      revision: main
 1156    downstream:
 1157      repo: nephio-my-ran
 1158      package: cluster-baseline
 1159    adoption: adoptExisting
 1160    packageContext:
 1161      data:
 1162        cluster-name: my-ran
 1163      repositoryRef:
 1164        name: nephio-my-ran
 1165    pipeline:
 1166      mutators:
 1167        - image: gcr.io/kpt-fn/apply-setters:v0.2
 1168          configMap:
 1169            cluster-name: my-ran
 1170  EOF
 1171  sleep 15
 1172  cat << 'EOF' | kubectl apply -f -
 1173  apiVersion: config.porch.kpt.dev/v1alpha2
 1174  kind: PackageVariant
 1175  metadata:
 1176    name: baseline-my-core
 1177    namespace: default
 1178  spec:
 1179    upstream:
 1180      repo: nephio-blueprints
 1181      package: cluster-baseline
 1182      revision: main
 1183    downstream:
 1184      repo: nephio-my-core
 1185      package: cluster-baseline
 1186    adoption: adoptExisting
 1187    packageContext:
 1188      data:
 1189        cluster-name: my-core
 1190      repositoryRef:
 1191        name: nephio-my-core
 1192    pipeline:
 1193      mutators:
 1194        - image: gcr.io/kpt-fn/apply-setters:v0.2
 1195          configMap:
 1196            cluster-name: my-core
 1197  EOF
 1198  kubectl api-resources | grep -i packagevariant
 1199  kubectl get packagevariants -A
 1200  kubectl get crd packagevariants.config.porch.kpt.dev -o jsonpath='{.spec.versions[*].name}'
 1201  cat << 'EOF' | kubectl apply -f -
 1202  apiVersion: config.porch.kpt.dev/v1alpha1
 1203  kind: PackageVariant
 1204  metadata:
 1205    name: baseline-my-ran
 1206    namespace: default
 1207  spec:
 1208    upstream:
 1209      repo: nephio-blueprints
 1210      package: cluster-baseline
 1211      revision: main
 1212    downstream:
 1213      repo: nephio-my-ran
 1214      package: cluster-baseline
 1215    adoptionPolicy: adoptExisting
 1216    injectors:
 1217      - name: my-ran
 1218    pipeline:
 1219      mutators:
 1220        - image: gcr.io/kpt-fn/apply-setters:v0.2
 1221          configMap:
 1222            cluster-name: my-ran
 1223  EOF
 1224  cat << 'EOF' | kubectl apply -f -
 1225  apiVersion: config.porch.kpt.dev/v1alpha1
 1226  kind: PackageVariant
 1227  metadata:
 1228    name: baseline-my-ran
 1229    namespace: default
 1230  spec:
 1231    upstream:
 1232      repo: nephio-blueprints
 1233      package: cluster-baseline
 1234    downstream:
 1235      repo: nephio-my-ran
 1236      package: cluster-baseline
 1237    adoptionPolicy: adoptExisting
 1238  EOF
 1239  cat << 'EOF' | kubectl apply -f -
 1240  apiVersion: config.porch.kpt.dev/v1alpha1
 1241  kind: PackageVariant
 1242  metadata:
 1243    name: baseline-my-core
 1244    namespace: default
 1245  spec:
 1246    upstream:
 1247      repo: nephio-blueprints
 1248      package: cluster-baseline
 1249    downstream:
 1250      repo: nephio-my-core
 1251      package: cluster-baseline
 1252    adoptionPolicy: adoptExisting
 1253  EOF
 1254  cat << 'EOF' | kubectl apply -f -
 1255  apiVersion: config.porch.kpt.dev/v1alpha1
 1256  kind: PackageVariant
 1257  metadata:
 1258    name: addons-my-ran
 1259    namespace: default
 1260  spec:
 1261    upstream:
 1262      repo: nephio-blueprints
 1263      package: platform-addons
 1264    downstream:
 1265      repo: nephio-my-ran
 1266      package: platform-addons
 1267    adoptionPolicy: adoptExisting
 1268  EOF
 1269  cat << 'EOF' | kubectl apply -f -
 1270  apiVersion: config.porch.kpt.dev/v1alpha1
 1271  kind: PackageVariant
 1272  metadata:
 1273    name: addons-my-core
 1274    namespace: default
 1275  spec:
 1276    upstream:
 1277      repo: nephio-blueprints
 1278      package: platform-addons
 1279    downstream:
 1280      repo: nephio-my-core
 1281      package: platform-addons
 1282    adoptionPolicy: adoptExisting
 1283  EOF
 1284  cat << 'EOF' | kubectl apply -f -
 1285  apiVersion: config.porch.kpt.dev/v1alpha1
 1286  kind: PackageVariant
 1287  metadata:
 1288    name: multus-my-ran
 1289    namespace: default
 1290  spec:
 1291    upstream:
 1292      repo: nephio-blueprints
 1293      package: multus-cni
 1294    downstream:
 1295      repo: nephio-my-ran
 1296      package: multus-cni
 1297    adoptionPolicy: adoptExisting
 1298  EOF
 1299  cat << 'EOF' | kubectl apply -f -
 1300  apiVersion: config.porch.kpt.dev/v1alpha1
 1301  kind: PackageVariant
 1302  metadata:
 1303    name: multus-my-core
 1304    namespace: default
 1305  spec:
 1306    upstream:
 1307      repo: nephio-blueprints
 1308      package: multus-cni
 1309    downstream:
 1310      repo: nephio-my-core
 1311      package: multus-cni
 1312    adoptionPolicy: adoptExisting
 1313  EOF
 1314  cat << 'EOF' | kubectl apply -f -
 1315  apiVersion: config.porch.kpt.dev/v1alpha1
 1316  kind: PackageVariant
 1317  metadata:
 1318    name: whereabouts-my-ran
 1319    namespace: default
 1320  spec:
 1321    upstream:
 1322      repo: nephio-blueprints
 1323      package: whereabouts-ipam
 1324    downstream:
 1325      repo: nephio-my-ran
 1326      package: whereabouts-ipam
 1327    adoptionPolicy: adoptExisting
 1328  EOF
 1329  cat << 'EOF' | kubectl apply -f -
 1330  apiVersion: config.porch.kpt.dev/v1alpha1
 1331  kind: PackageVariant
 1332  metadata:
 1333    name: whereabouts-my-core
 1334    namespace: default
 1335  spec:
 1336    upstream:
 1337      repo: nephio-blueprints
 1338      package: whereabouts-ipam
 1339    downstream:
 1340      repo: nephio-my-core
 1341      package: whereabouts-ipam
 1342    adoptionPolicy: adoptExisting
 1343  EOF
 1344  kubectl get packagevariants
 1345  kubectl get packagerevisions | grep -E "my-ran|my-core"
 1346  kubectl get packagevariants -o wide
 1347  # Approve all my-ran packages
 1348  kubectl get packagerevisions -o name | grep my-ran | while read pr; do   echo "Approving $pr";   kubectl patch $pr --type=merge -p '{"spec":{"lifecycle":"Published"}}'; done
 1349  # Approve all my-core packages  
 1350  kubectl get packagerevisions -o name | grep my-core | while read pr; do   echo "Approving $pr";   kubectl patch $pr --type=merge -p '{"spec":{"lifecycle":"Published"}}'; done
 1351  kubectl get packagerevisions | grep Published
 1352  porch
 1353  porchctl
 1354  porch --version
 1355  kubectl describe packagevariant baseline-my-ran
 1356  kubectl describe packagevariant addons-my-ran
 1357  kubectl get packagerevisions -A | grep -E "nephio-my-ran|nephio-my-core"
 1358  kubectl logs -n porch-system deployment/porch-server --tail=100 | grep -i error
 1359  kubectl get repository nephio-my-ran -o yaml
 1360  kubectl get repository nephio-my-core -o yaml
 1361  kubectl create secret generic github-credentials   --namespace=default   --from-literal=username=RehanFazal77   --from-literal=password=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
 1362  # Delete existing repos (Porch will recreate them)
 1363  kubectl delete repository nephio-my-ran
 1364  kubectl delete repository nephio-my-core
 1365  # Recreate with credentials
 1366  cat << 'EOF' | kubectl apply -f -
 1367  apiVersion: config.porch.kpt.dev/v1alpha1
 1368  kind: Repository
 1369  metadata:
 1370    name: nephio-my-ran
 1371    namespace: default
 1372  spec:
 1373    description: Deployment for RAN
 1374    type: git
 1375    content: Package
 1376    deployment: true
 1377    git:
 1378      repo: https://github.com/RehanFazal77/nephio-my-ran.git
 1379      branch: main
 1380      secretRef:
 1381        name: github-credentials
 1382  EOF
 1383  cat << 'EOF' | kubectl apply -f -
 1384  apiVersion: config.porch.kpt.dev/v1alpha1
 1385  kind: Repository
 1386  metadata:
 1387    name: nephio-my-core
 1388    namespace: default
 1389  spec:
 1390    description: Deployment for CORE
 1391    type: git
 1392    content: Package
 1393    deployment: true
 1394    git:
 1395      repo: https://github.com/RehanFazal77/nephio-my-core.git
 1396      branch: main
 1397      secretRef:
 1398        name: github-credentials
 1399  EOF
 1400  # Delete all packagevariants
 1401  kubectl delete packagevariants --all
 1402  # Then re-apply them (I'll give you the commands after you complete steps 1-3)
 1403  cat << 'EOF' | kubectl apply -f -
 1404  apiVersion: config.porch.kpt.dev/v1alpha1
 1405  kind: PackageVariant
 1406  metadata:
 1407    name: baseline-my-ran
 1408    namespace: default
 1409  spec:
 1410    upstream:
 1411      repo: nephio-blueprints
 1412      package: cluster-baseline
 1413    downstream:
 1414      repo: nephio-my-ran
 1415      package: cluster-baseline
 1416    adoptionPolicy: adoptExisting
 1417  EOF
 1418  cat << 'EOF' | kubectl apply -f -
 1419  apiVersion: config.porch.kpt.dev/v1alpha1
 1420  kind: PackageVariant
 1421  metadata:
 1422    name: baseline-my-core
 1423    namespace: default
 1424  spec:
 1425    upstream:
 1426      repo: nephio-blueprints
 1427      package: cluster-baseline
 1428    downstream:
 1429      repo: nephio-my-core
 1430      package: cluster-baseline
 1431    adoptionPolicy: adoptExisting
 1432  EOF
 1433  cat << 'EOF' | kubectl apply -f -
 1434  apiVersion: config.porch.kpt.dev/v1alpha1
 1435  kind: PackageVariant
 1436  metadata:
 1437    name: addons-my-ran
 1438    namespace: default
 1439  spec:
 1440    upstream:
 1441      repo: nephio-blueprints
 1442      package: platform-addons
 1443    downstream:
 1444      repo: nephio-my-ran
 1445      package: platform-addons
 1446    adoptionPolicy: adoptExisting
 1447  EOF
 1448  cat << 'EOF' | kubectl apply -f -
 1449  apiVersion: config.porch.kpt.dev/v1alpha1
 1450  kind: PackageVariant
 1451  metadata:
 1452    name: addons-my-core
 1453    namespace: default
 1454  spec:
 1455    upstream:
 1456      repo: nephio-blueprints
 1457      package: platform-addons
 1458    downstream:
 1459      repo: nephio-my-core
 1460      package: platform-addons
 1461    adoptionPolicy: adoptExisting
 1462  EOF
 1463  cat << 'EOF' | kubectl apply -f -
 1464  apiVersion: config.porch.kpt.dev/v1alpha1
 1465  kind: PackageVariant
 1466  metadata:
 1467    name: multus-my-ran
 1468    namespace: default
 1469  spec:
 1470    upstream:
 1471      repo: nephio-blueprints
 1472      package: multus-cni
 1473    downstream:
 1474      repo: nephio-my-ran
 1475      package: multus-cni
 1476    adoptionPolicy: adoptExisting
 1477  EOF
 1478  cat << 'EOF' | kubectl apply -f -
 1479  apiVersion: config.porch.kpt.dev/v1alpha1
 1480  kind: PackageVariant
 1481  metadata:
 1482    name: multus-my-core
 1483    namespace: default
 1484  spec:
 1485    upstream:
 1486      repo: nephio-blueprints
 1487      package: multus-cni
 1488    downstream:
 1489      repo: nephio-my-core
 1490      package: multus-cni
 1491    adoptionPolicy: adoptExisting
 1492  EOF
 1493  cat << 'EOF' | kubectl apply -f -
 1494  apiVersion: config.porch.kpt.dev/v1alpha1
 1495  kind: PackageVariant
 1496  metadata:
 1497    name: whereabouts-my-ran
 1498    namespace: default
 1499  spec:
 1500    upstream:
 1501      repo: nephio-blueprints
 1502      package: whereabouts-ipam
 1503    downstream:
 1504      repo: nephio-my-ran
 1505      package: whereabouts-ipam
 1506    adoptionPolicy: adoptExisting
 1507  EOF
 1508  cat << 'EOF' | kubectl apply -f -
 1509  apiVersion: config.porch.kpt.dev/v1alpha1
 1510  kind: PackageVariant
 1511  metadata:
 1512    name: whereabouts-my-core
 1513    namespace: default
 1514  spec:
 1515    upstream:
 1516      repo: nephio-blueprints
 1517      package: whereabouts-ipam
 1518    downstream:
 1519      repo: nephio-my-core
 1520      package: whereabouts-ipam
 1521    adoptionPolicy: adoptExisting
 1522  EOF
 1523  # Wait 30 seconds for Porch to process
 1524  sleep 30
 1525  # Check PackageVariants status
 1526  kubectl get packagevariants
 1527  # Check if any PackageRevisions were created for downstream repos
 1528  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1529  # Check status of one PackageVariant for errors
 1530  kubectl describe packagevariant baseline-my-ran | grep -A5 "Status:"
 1531  kubectl get secret github-credentials -o yaml
 1532  kubectl get repository nephio-my-ran -o yaml | grep -A3 secretRef
 1533  # Delete old secret
 1534  kubectl delete secret github-credentials
 1535  # Create with proper type
 1536  kubectl create secret generic github-credentials   --namespace=default   --type=kubernetes.io/basic-auth   --from-literal=username=RehanFazal77   --from-literal=password=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
 1537  kubectl rollout restart deployment porch-server -n porch-system
 1538  sleep 60
 1539  kubectl describe packagevariant baseline-my-ran | grep -A5 "Status:"
 1540  # Check the draft PackageRevisions
 1541  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1542  # Approve/Publish all packages for my-ran
 1543  kubectl get packagerevisions -o name | grep nephio-my-ran | while read pr; do   echo "Publishing $pr";   kubectl patch $pr --type=merge -p '{"spec":{"lifecycle":"Published"}}'; done
 1544  # Approve/Publish all packages for my-core
 1545  kubectl get packagerevisions -o name | grep nephio-my-core | while read pr; do   echo "Publishing $pr";   kubectl patch $pr --type=merge -p '{"spec":{"lifecycle":"Published"}}'; done
 1546  # Verify they're Published
 1547  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1548  # Propose all my-ran packages
 1549  kubectl get packagerevisions -o name | grep nephio-my-ran | while read pr; do   echo "Proposing $pr";   kubectl patch $pr --type=merge -p '{"spec":{"lifecycle":"Proposed"}}'; done
 1550  # Propose all my-core packages
 1551  kubectl get packagerevisions -o name | grep nephio-my-core | while read pr; do   echo "Proposing $pr";   kubectl patch $pr --type=merge -p '{"spec":{"lifecycle":"Proposed"}}'; done
 1552  # Publish all my-ran packages
 1553  kubectl get packagerevisions -o name | grep nephio-my-ran | while read pr; do   echo "Publishing $pr";   kubectl patch $pr --type=merge -p '{"spec":{"lifecycle":"Published"}}'; done
 1554  # Publish all my-core packages
 1555  kubectl get packagerevisions -o name | grep nephio-my-core | while read pr; do   echo "Publishing $pr";   kubectl patch $pr --type=merge -p '{"spec":{"lifecycle":"Published"}}'; done
 1556  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1557  kubectl get packagevariants -o wide
 1558  kubectl describe packagevariant multus-my-ran | grep -A10 "Status:"
 1559  # Approve all my-ran packages
 1560  kubectl get packagerevisions -o name | grep nephio-my-ran | while read pr; do   echo "Approving $pr";   kubectl patch $pr --type=merge --subresource=approval -p '{"spec":{"approval":"Approved"}}'; done
 1561  # Approve all my-core packages
 1562  kubectl get packagerevisions -o name | grep nephio-my-core | while read pr; do   echo "Approving $pr";   kubectl patch $pr --type=merge --subresource=approval -p '{"spec":{"approval":"Approved"}}'; done
 1563  # Check what packages Porch sees in nephio-blueprints
 1564  kubectl get packagerevisions | grep nephio-blueprints
 1565  # Check the actual files in your local repo
 1566  ls -la ~/nephio-blueprints/
 1567  ls -la ~/nephio-blueprints/multus-cni/
 1568  cat ~/nephio-blueprints/multus-cni/Kptfile
 1569  # For each package, set both lifecycle and approval together
 1570  kubectl patch packagerevision nephio-my-ran.cluster-baseline.packagevariant-1   --type=merge -p '{"spec":{"lifecycle":"Published"}}'
 1571  # Use strategic merge with approval field
 1572  kubectl get packagerevision nephio-my-ran.cluster-baseline.packagevariant-1 -o yaml > /tmp/pr.yaml
 1573  # Edit and change lifecycle to Published
 1574  sed -i 's/lifecycle: Proposed/lifecycle: Published/' /tmp/pr.yaml
 1575  # Apply it back
 1576  kubectl apply -f /tmp/pr.yaml
 1577  # Delete the proposed packagerevisions (PackageVariant will recreate)
 1578  kubectl delete packagerevision nephio-my-ran.cluster-baseline.packagevariant-1
 1579  kubectl delete packagerevision nephio-my-ran.platform-addons.packagevariant-1
 1580  kubectl delete packagerevision nephio-my-core.cluster-baseline.packagevariant-1
 1581  kubectl delete packagerevision nephio-my-core.platform-addons.packagevariant-1
 1582  kubectl delete packagevariant multus-my-ran multus-my-core whereabouts-my-ran whereabouts-my-core
 1583  # Wait a moment
 1584  sleep 5
 1585  # Recreate them
 1586  cat << 'EOF' | kubectl apply -f -
 1587  apiVersion: config.porch.kpt.dev/v1alpha1
 1588  kind: PackageVariant
 1589  metadata:
 1590    name: multus-my-ran
 1591    namespace: default
 1592  spec:
 1593    upstream:
 1594      repo: nephio-blueprints
 1595      package: multus-cni
 1596    downstream:
 1597      repo: nephio-my-ran
 1598      package: multus-cni
 1599    adoptionPolicy: adoptExisting
 1600  ---
 1601  apiVersion: config.porch.kpt.dev/v1alpha1
 1602  kind: PackageVariant
 1603  metadata:
 1604    name: multus-my-core
 1605    namespace: default
 1606  spec:
 1607    upstream:
 1608      repo: nephio-blueprints
 1609      package: multus-cni
 1610    downstream:
 1611      repo: nephio-my-core
 1612      package: multus-cni
 1613    adoptionPolicy: adoptExisting
 1614  ---
 1615  apiVersion: config.porch.kpt.dev/v1alpha1
 1616  kind: PackageVariant
 1617  metadata:
 1618    name: whereabouts-my-ran
 1619    namespace: default
 1620  spec:
 1621    upstream:
 1622      repo: nephio-blueprints
 1623      package: whereabouts-ipam
 1624    downstream:
 1625      repo: nephio-my-ran
 1626      package: whereabouts-ipam
 1627    adoptionPolicy: adoptExisting
 1628  ---
 1629  apiVersion: config.porch.kpt.dev/v1alpha1
 1630  kind: PackageVariant
 1631  metadata:
 1632    name: whereabouts-my-core
 1633    namespace: default
 1634  spec:
 1635    upstream:
 1636      repo: nephio-blueprints
 1637      package: whereabouts-ipam
 1638    downstream:
 1639      repo: nephio-my-core
 1640      package: whereabouts-ipam
 1641    adoptionPolicy: adoptExisting
 1642  EOF
 1643  # Wait for Porch to recreate packages
 1644  sleep 30
 1645  # Check all PackageVariants status
 1646  kubectl get packagevariants
 1647  # Check all PackageRevisions for our repos
 1648  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1649  # Check status of one of the new PackageVariants
 1650  kubectl describe packagevariant baseline-my-ran | grep -A10 "Status:"
 1651  # Check if porchctl exists or can be installed
 1652  which porchctl
 1653  # Or try using kpt
 1654  which kpt
 1655  kpt version
 1656  # List packages using kpt
 1657  kpt alpha rpkg get | grep -E "nephio-my-ran|nephio-my-core"
 1658  # Approve packages using kpt (propose first, then approve)
 1659  kpt alpha rpkg propose nephio-my-ran.cluster-baseline.packagevariant-1
 1660  kpt alpha rpkg approve nephio-my-ran.cluster-baseline.packagevariant-1
 1661  kpt alpha rpkg propose nephio-my-ran.platform-addons.packagevariant-1
 1662  kpt alpha rpkg approve nephio-my-ran.platform-addons.packagevariant-1
 1663  kpt alpha rpkg propose nephio-my-core.cluster-baseline.packagevariant-1
 1664  kpt alpha rpkg approve nephio-my-core.cluster-baseline.packagevariant-1
 1665  kpt alpha rpkg propose nephio-my-core.platform-addons.packagevariant-1
 1666  kpt alpha rpkg approve nephio-my-core.platform-addons.packagevariant-1
 1667  kubectl describe packagevariant multus-my-ran | grep -A10 "Status:"
 1668  kubectl describe packagevariant whereabouts-my-ran | grep -A10 "Status:"
 1669  # Check if any multus/whereabouts packagerevisions exist
 1670  kubectl get packagerevisions | grep -E "multus|whereabouts" | grep -E "my-ran|my-core"
 1671  # Download porchctl
 1672  curl -LO https://github.com/nephio-project/porch/releases/download/v0.0.25/porchctl_0.0.25_linux_amd64.tar.gz
 1673  # Extract
 1674  tar -xzf porchctl_0.0.25_linux_amd64.tar.gz
 1675  # Move to path
 1676  sudo mv porchctl /usr/local/bin/
 1677  # Verify
 1678  porchctl version
 1679  wget https://github.com/nephio-project/porch/releases/download/dev/porchctl.tgz
 1680  tar -xzf porchctl.tgz 
 1681  ls
 1682  sudo mv porchctl /usr/local/bin/
 1683  # Verify
 1684  porchctl version
 1685  porchctl rpkg get -n default | grep -E "nephio-my-ran|nephio-my-core"
 1686  porchctl rpkg propose nephio-my-ran.cluster-baseline.packagevariant-1 -n default
 1687  porchctl rpkg propose nephio-my-ran.platform-addons.packagevariant-1 -n default
 1688  porchctl rpkg propose nephio-my-core.cluster-baseline.packagevariant-1 -n default
 1689  porchctl rpkg propose nephio-my-core.platform-addons.packagevariant-1 -n default
 1690  porchctl rpkg approve nephio-my-ran.cluster-baseline.packagevariant-1 -n default
 1691  porchctl rpkg approve nephio-my-ran.platform-addons.packagevariant-1 -n default
 1692  porchctl rpkg approve nephio-my-core.cluster-baseline.packagevariant-1 -n default
 1693  porchctl rpkg approve nephio-my-core.platform-addons.packagevariant-1 -n default
 1694  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1695  porchctl rpkg propose nephio-my-core.whereabouts-ipam.packagevariant-1 -n default
 1696  porchctl rpkg approve nephio-my-core.whereabouts-ipam.packagevariant-1 -n default
 1697  kubectl get nodes 
 1698  kubectl get cluster
 1699  kubectl config use-context my-core 
 1700  kubectl get pods -A 
 1701  kubectl config use-context nephio-mgmt
 1702  kubectl config use-context my-ran
 1703  cat << 'EOF' | kubectl apply -f -
 1704  apiVersion: configsync.gke.io/v1beta1
 1705  kind: RootSync
 1706  metadata:
 1707    name: root-sync
 1708    namespace: config-management-system
 1709  spec:
 1710    sourceType: git
 1711    git:
 1712      repo: https://github.com/RehanFazal77/nephio-my-ran.git
 1713      branch: main
 1714      dir: /
 1715      auth: none
 1716  EOF
 1717  kubectl config use-context my-core
 1718  cat << 'EOF' | kubectl apply -f -
 1719  apiVersion: configsync.gke.io/v1beta1
 1720  kind: RootSync
 1721  metadata:
 1722    name: root-sync
 1723    namespace: config-management-system
 1724  spec:
 1725    sourceType: git
 1726    git:
 1727      repo: https://github.com/RehanFazal77/nephio-my-core.git
 1728      branch: main
 1729      dir: /
 1730      auth: none
 1731  EOF
 1732  # Check RootSync status
 1733  kubectl --context=my-ran get rootsync -n config-management-system
 1734  kubectl --context=my-core get rootsync -n config-management-system
 1735  # Wait 60 seconds and check what got deployed
 1736  sleep 60
 1737  # Check namespaces created (from cluster-baseline package)
 1738  kubectl --context=my-ran get ns | grep -E "openairinterface|free5gc|local-path"
 1739  kubectl --context=my-core get ns | grep -E "openairinterface|free5gc|local-path"
 1740  # Check storage class (from platform-addons package)
 1741  kubectl --context=my-ran get sc
 1742  kubectl --context=my-core get sc
 1743  kubectl get nodes 
 1744  kubectl get rootsyncs.configsync.gke.io 
 1745  kubectl --context=my-ran describe rootsync root-sync -n config-management-system
 1746  kubectl --context=my-core describe rootsync root-sync -n config-management-system
 1747  kubectl --context=my-ran get pods -n config-management-system
 1748  kubectl --context=my-core get pods -n config-management-system
 1749  kubectl --context=my-ran logs -n config-management-system -l configsync.gke.io/reconciler=root-reconciler --tail=50
 1750  kubectl get rootsyncs.configsync.gke.io 
 1751  kubectl config use-context my-ran
 1752  cat << 'EOF' | kubectl apply -f -
 1753  apiVersion: configsync.gke.io/v1beta1
 1754  kind: RootSync
 1755  metadata:
 1756    name: root-sync
 1757    namespace: config-management-system
 1758  spec:
 1759    sourceFormat: unstructured
 1760    sourceType: git
 1761    git:
 1762      repo: https://github.com/RehanFazal77/nephio-my-ran.git
 1763      branch: main
 1764      dir: /
 1765      auth: none
 1766  EOF
 1767  kubectl config use-context my-core
 1768  cat << 'EOF' | kubectl apply -f -
 1769  apiVersion: configsync.gke.io/v1beta1
 1770  kind: RootSync
 1771  metadata:
 1772    name: root-sync
 1773    namespace: config-management-system
 1774  spec:
 1775    sourceFormat: unstructured
 1776    sourceType: git
 1777    git:
 1778      repo: https://github.com/RehanFazal77/nephio-my-core.git
 1779      branch: main
 1780      dir: /
 1781      auth: none
 1782  EOF
 1783  # Wait for reconciler to restart
 1784  sleep 30
 1785  # Check status
 1786  kubectl --context=my-ran describe rootsync root-sync -n config-management-system | grep -A20 "Status:"
 1787  kubectl --context=my-core describe rootsync root-sync -n config-management-system | grep -A20 "Status:"
 1788  # Check if namespaces were created
 1789  kubectl --context=my-ran get ns
 1790  kubectl --context=my-core get ns
 1791  kubectl get rootsyncs.configsync.gke.io 
 1792  kubectl get nodes 
 1793  cd ~
 1794  # Clone and fix nephio-my-ran
 1795  git clone https://github.com/RehanFazal77/nephio-my-ran.git temp-my-ran
 1796  cd temp-my-ran
 1797  # Find the problematic file
 1798  grep -r "config-management-system" --include="*.yaml"
 1799  # List all files
 1800  find . -name "*.yaml" | head -20
 1801  # Do the same for nephio-my-core
 1802  cd ~
 1803  git clone https://github.com/RehanFazal77/nephio-my-core.git temp-my-core
 1804  cd temp-my-core
 1805  grep -r "config-management-system" --include="*.yaml"
 1806  find . -name "*.yaml" | head -20
 1807  cd ~/temp-my-ran
 1808  # Delete the problematic files
 1809  rm cluster-baseline/configsync.yaml
 1810  rm cluster-baseline/rootsync.yaml
 1811  # Commit and push
 1812  git add .
 1813  git commit -m "Remove ConfigSync files that conflict with config-management-system namespace"
 1814  git push origin main
 1815  cd ~/temp-my-core
 1816  # Delete the problematic files
 1817  rm cluster-baseline/configsync.yaml
 1818  rm cluster-baseline/rootsync.yaml
 1819  # Commit and push
 1820  git add .
 1821  git commit -m "Remove ConfigSync files that conflict with config-management-system namespace"
 1822  git push origin main
 1823  # Wait for ConfigSync to pick up changes
 1824  sleep 30
 1825  # Check status
 1826  kubectl --context=my-ran describe rootsync root-sync -n config-management-system | grep -A10 "Syncing"
 1827  kubectl --context=my-core describe rootsync root-sync -n config-management-system | grep -A10 "Syncing"
 1828  # Check namespaces
 1829  kubectl --context=my-ran get ns
 1830  kubectl --context=my-core get ns
 1831  kubectl get rootsyncs.configsync.gke.io 
 1832  # Check storage class
 1833  kubectl --context=my-ran get sc
 1834  kubectl --context=my-core get sc
 1835  # Check all resources in local-path-storage namespace
 1836  kubectl --context=my-ran get all -n local-path-storage
 1837  kubectl --context=my-core get all -n local-path-storage
 1838  # Check RootSync final status
 1839  kubectl --context=my-ran get rootsync -n config-management-system
 1840  kubectl --context=my-core get rootsync -n config-management-system
 1841  # Summary from management cluster
 1842  kubectl config use-context nephio-mgmt
 1843  echo "=== ClusterContexts ===" && kubectl get clustercontexts
 1844  echo "=== Repositories ===" && kubectl get repositories
 1845  echo "=== PackageVariants ===" && kubectl get packagevariants
 1846  echo "=== Published PackageRevisions ===" && kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core" | grep Published
 1847  kubectl get rootsyncs.configsync.gke.io 
 1848  keubcget nodes 
 1849  kubectl get nodes 
 1850  kubectl config use-context my-core 
 1851  kubectl get rootsyncs.configsync.gke.io 
 1852  kubectl get nodes 
 1853  kubectl get pods -A
 1854  kubectl get ns
 1855  kubectl get rootsyncs.configsync.gke.io  -A 
 1856  kubectl get rootsyncs.configsync.gke.io  -A  -w
 1857  kubectl get pod -A 
 1858  echo "=============================================="
 1859  echo "NEPHIO GITOPS INTEGRATION STATUS REPORT"
 1860  echo "Date: $(date)"
 1861  echo "=============================================="
 1862  echo ""
 1863  echo "=== 1. CLUSTER CONTEXTS ==="
 1864  kubectl config use-context nephio-mgmt
 1865  kubectl get clustercontexts
 1866  echo ""
 1867  echo "=== 2. REPOSITORIES ==="
 1868  kubectl get repositories
 1869  echo ""
 1870  echo "=== 3. PACKAGE VARIANTS ==="
 1871  kubectl get packagevariants
 1872  echo ""
 1873  echo "=== 4. PACKAGE REVISIONS (Published in downstream repos) ==="
 1874  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core" | grep Published
 1875  echo ""
 1876  echo "=== 5. PACKAGE REVISIONS (All in downstream repos) ==="
 1877  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1878  echo ""
 1879  echo "=== 6. BLUEPRINT PACKAGES AVAILABLE ==="
 1880  kubectl get packagerevisions | grep nephio-blueprints
 1881  echo ""
 1882  echo "=== 7. CONFIG SYNC STATUS - MY-RAN ==="
 1883  kubectl --context=my-ran get rootsync -n config-management-system
 1884  echo ""
 1885  echo "=== 8. CONFIG SYNC STATUS - MY-CORE ==="
 1886  kubectl --context=my-core get rootsync -n config-management-system
 1887  echo ""
 1888  echo "=== 9. NAMESPACES ON MY-RAN ==="
 1889  kubectl --context=my-ran get ns
 1890  echo ""
 1891  echo "=== 10. NAMESPACES ON MY-CORE ==="
 1892  kubectl --context=my-core get ns
 1893  echo ""
 1894  echo "=== 11. STORAGE CLASSES - MY-RAN ==="
 1895  kubectl --context=my-ran get sc
 1896  echo ""
 1897  echo "=== 12. STORAGE CLASSES - MY-CORE ==="
 1898  kubectl --context=my-core get sc
 1899  echo ""
 1900  echo "=== 13. DEPLOYED RESOURCES IN LOCAL-PATH-STORAGE (MY-RAN) ==="
 1901  kubectl --context=my-ran get all -n local-path-storage
 1902  echo ""
 1903  echo "=== 14. DEPLOYED RESOURCES IN LOCAL-PATH-STORAGE (MY-CORE) ==="
 1904  kubectl --context=my-core get all -n local-path-storage
 1905  echo ""
 1906  echo "=============================================="
 1907  echo "SUMMARY"
 1908  echo "=============================================="
 1909  echo "✅ ConfigSync installed on both clusters"
 1910  echo "✅ ClusterContexts: 2 (my-ran, my-core)"
 1911  echo "✅ Repositories: 3 (nephio-blueprints, nephio-my-ran, nephio-my-core)"
 1912  echo "✅ PackageVariants: 8 created"
 1913  echo "✅ Published Packages: cluster-baseline, platform-addons on both clusters"
 1914  echo "✅ Namespaces deployed: openairinterface, free5gc, local-path-storage"
 1915  echo "⚠️  Pending: multus-cni and whereabouts-ipam packages (upstream resolution issue)"
 1916  echo "=============================================="
 1917  echo "Date: $(date)"
 1918  echo "=============================================="
 1919  echo ""
 1920  echo "=== 1. CLUSTER CONTEXTS ==="
 1921  kubectl config use-context nephio-mgmt
 1922  kubectl get clustercontexts
 1923  echo ""
 1924  echo "=== 2. REPOSITORIES ==="
 1925  kubectl get repositories
 1926  echo ""
 1927  echo "=== 3. PACKAGE VARIANTS ==="
 1928  kubectl get packagevariants
 1929  echo ""
 1930  echo "=== 4. PACKAGE REVISIONS (Published in downstream repos) ==="
 1931  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core" | grep Published
 1932  echo ""
 1933  echo "=== 5. PACKAGE REVISIONS (All in downstream repos) ==="
 1934  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1935  echo ""
 1936  echo "=== 6. BLUEPRINT PACKAGES AVAILABLE ==="
 1937  kubectl get packagerevisions | grep nephio-blueprints
 1938  echo ""
 1939  echo "=== 7. CONFIG SYNC STATUS - MY-RAN ==="
 1940  kubectl --context=my-ran get rootsync -n config-management-system
 1941  echo ""
 1942  echo "=== 8. CONFIG SYNC STATUS - MY-CORE ==="
 1943  kubectl --context=my-core get rootsync -n config-management-system
 1944  echo ""
 1945  echo "=== 9. NAMESPACES ON MY-RAN ==="
 1946  kubectl --context=my-ran get ns
 1947  echo ""
 1948  echo "=== 10. NAMESPACES ON MY-CORE ==="
 1949  kubectl --context=my-core get ns
 1950  echo ""
 1951  echo "=== 11. STORAGE CLASSES - MY-RAN ==="
 1952  kubectl --context=my-ran get sc
 1953  kubectl get clustercontexts.infra.nephio.org 
 1954  echo "=============================================="
 1955  echo "NEPHIO GITOPS INTEGRATION STATUS REPORT"
 1956  echo "Date: $(date)"
 1957  echo "=============================================="
 1958  echo ""
 1959  echo "=== 1. CLUSTER CONTEXTS ==="
 1960  kubectl config use-context nephio-mgmt
 1961  kubectl get clustercontexts
 1962  echo ""
 1963  echo "=== 2. REPOSITORIES ==="
 1964  kubectl get repositories
 1965  echo ""
 1966  echo "=== 3. PACKAGE VARIANTS ==="
 1967  kubectl get packagevariants
 1968  echo ""
 1969  echo "=== 4. PACKAGE REVISIONS (Published in downstream repos) ==="
 1970  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core" | grep Published
 1971  echo ""
 1972  echo "=== 5. PACKAGE REVISIONS (All in downstream repos) ==="
 1973  kubectl get packagerevisions | grep -E "nephio-my-ran|nephio-my-core"
 1974  echo ""
 1975  echo "=== 6. BLUEPRINT PACKAGES AVAILABLE ==="
 1976  kubectl get packagerevisions | grep nephio-blueprints
 1977  echo ""
 1978  echo "=== 7. CONFIG SYNC STATUS - MY-RAN ==="
 1979  kubectl --context=my-ran get rootsync -n config-management-system
 1980  echo ""
 1981  echo "=== 8. CONFIG SYNC STATUS - MY-CORE ==="
 1982  kubectl --context=my-core get rootsync -n config-management-system
 1983  echo ""
 1984  echo "=== 9. NAMESPACES ON MY-RAN ==="
 1985  kubectl --context=my-ran get ns
 1986  echo ""
 1987  echo "=== 10. NAMESPACES ON MY-CORE ==="
 1988  kubectl --context=my-core get ns
 1989  echo ""
 1990  echo "=== 11. STORAGE CLASSES - MY-RAN ==="
 1991  kubectl --context=my-ran get sc
 1992  echo ""
 1993  echo "=== 12. STORAGE CLASSES - MY-CORE ==="
 1994  kubectl --context=my-core get sc
 1995  echo ""
 1996  echo "=== 13. DEPLOYED RESOURCES IN LOCAL-PATH-STORAGE (MY-RAN) ==="
 1997  kubectl --context=my-ran get all -n local-path-storage
 1998  echo ""
 1999  echo "=== 14. DEPLOYED RESOURCES IN LOCAL-PATH-STORAGE (MY-CORE) ==="
 2000  kubectl --context=my-core get all -n local-path-storage
 2001  echo ""
 2002  echo "=============================================="
 2003  echo "SUMMARY"
 2004  echo "=============================================="
 2005  echo "✅ ConfigSync installed on both clusters"
 2006  echo "✅ ClusterContexts: 2 (my-ran, my-core)"
 2007  echo "✅ Repositories: 3 (nephio-blueprints, nephio-my-ran, nephio-my-core)"
 2008  echo "✅ PackageVariants: 8 created"
 2009  echo "✅ Published Packages: cluster-baseline, platform-addons on both clusters"
 2010  echo "✅ Namespaces deployed: openairinterface, free5gc, local-path-storage"
 2011  echo "⚠️  Pending: multus-cni and whereabouts-ipam packages (upstream resolution issue)"
 2012  echo "=============================================="
 2013  git clone https://github.com/RehanFazal77/nephio-existing-clusters.git 
 2014  ls
 2015  mkdir 27jan
 2016  cd 27jan/
 2017  git clone https://github.com/sknrao/nephio-existing-clusters.git 
 2018  cd nephio-existing-clusters/
 2019  cd 4-platform-addons/
 2020  ls
 2021  cd Kpt/
 2022  ls
 2023  kubectl apply -f all-pvs.yaml 
 2024  kubectl get pods -A | grep poe
 2025  kubectl get pods -A | grep por
 2026  history
 2027  histor > log.txt
 2028  history > log.txt
